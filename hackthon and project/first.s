	PRESERVE8
	AREA     ENCRYPTDATA, DATA, READWRITE
	

DES_C		SPACE	4
DES_D		SPACE	4

DES_L				SPACE	4
DES_R				SPACE	4
DES_s_output		SPACE	4
DES_f_function_res	SPACE	4
DES_temp			SPACE	4

DES_sub_key				SPACE	128

DES_s_input				SPACE	8
DES_permuted_choice_1	SPACE	8
DES_permuted_choice_2	SPACE	8

DES_init_perm_res		SPACE	8
DES_inv_init_perm_res	SPACE	8
DES_pre_output			SPACE	8
DES_SATIR				SPACE	1
DES_SATUN				SPACE 	1

	ALIGN	
	 AREA     ENCRYPTION, CODE, READONLY
     EXPORT __main
	 EXPORT __DESENCRYPT
	 ENTRY	

Init_Permutation			DCB 0x3a , 0x32 , 0x2a , 0x22 , 0x1a , 0x12 , 0x0a , 0x02 , 0x3c , 0x34 , 0x2c , 0x24 , 0x1c , 0x14 , 0x0c , 0x04 , 0x3e , 0x36 , 0x2e , 0x26 , 0x1e , 0x16 , 0x0e , 0x06 , 0x40 , 0x38 , 0x30 , 0x28 , 0x20 , 0x18 , 0x10 , 0x08 , 0x39 , 0x31 , 0x29 , 0x21 , 0x19 , 0x11 , 0x09 , 0x01 , 0x3b , 0x33 , 0x2b , 0x23 , 0x1b , 0x13 , 0x0b , 0x03 , 0x3d , 0x35 , 0x2d , 0x25 , 0x1d , 0x15 , 0x0d , 0x05 , 0x3f , 0x37 , 0x2f , 0x27 , 0x1f , 0x17 , 0x0f , 0x07
Permutation_Inverse			DCB 0x28 , 0x08 , 0x30 , 0x10 , 0x38 , 0x18 , 0x40 , 0x20 , 0x27 , 0x07 , 0x2f , 0x0f , 0x37 , 0x17 , 0x3f , 0x1f , 0x26 , 0x06 , 0x2e , 0x0e , 0x36 , 0x16 , 0x3e , 0x1e , 0x25 , 0x05 , 0x2d , 0x0d , 0x35 , 0x15 , 0x3d , 0x1d , 0x24 , 0x04 , 0x2c , 0x0c , 0x34 , 0x14 , 0x3c , 0x1c , 0x23 , 0x03 , 0x2b , 0x0b , 0x33 , 0x13 , 0x3b , 0x1b , 0x22 , 0x02 , 0x2a , 0x0a , 0x32 , 0x12 , 0x3a , 0x1a , 0x21 , 0x01 , 0x29 , 0x09 , 0x31 , 0x11 , 0x39 , 0x19
Cons_E						DCB 0x02 , 0x01 , 0x02 , 0x03 , 0x04 , 0x05 , 0x04 , 0x05 , 0x06 , 0x07 , 0x08 , 0x09 , 0x08 , 0x09 , 0x0a , 0x0b , 0x0c , 0x0d , 0x0c , 0x0d , 0x0e , 0x0f , 0x10 , 0x11 , 0x10 , 0x11 , 0x12 , 0x13 , 0x14 , 0x15 , 0x14 , 0x15 , 0x16 , 0x17 , 0x18 , 0x19 , 0x18 , 0x19 , 0x1a , 0x1b , 0x1c , 0x1d , 0x1c , 0x1d , 0x1e , 0x1f , 0x20 , 0x01
Cons_P						DCB 0x10 , 0x07 , 0x14 , 0x15 , 0x1d , 0x0c , 0x1c , 0x11 , 0x01 , 0x0f , 0x17 , 0x1a , 0x05 , 0x12 , 0x1f , 0x0a , 0x02 , 0x08 , 0x18 , 0x0e , 0x20 , 0x1b , 0x03 , 0x09 , 0x13 , 0x0d , 0x1e , 0x06 , 0x16 , 0x0b , 0x04 , 0x19
Cons_pc1 					DCB 0x39 , 0x31 , 0x29 , 0x21 , 0x19 , 0x11 , 0x09 , 0x01 , 0x3a , 0x32 , 0x2a , 0x22 , 0x1a , 0x12 , 0x0a , 0x02 , 0x3b , 0x33 , 0x2b , 0x23 , 0x1b , 0x13 , 0x0b , 0x03 , 0x3c , 0x34 , 0x2c , 0x24 , 0x3f , 0x37 , 0x2f , 0x27 , 0x1f , 0x17 , 0x0f , 0x07 , 0x3e , 0x36 , 0x2e , 0x26 , 0x1e , 0x16 , 0x0e , 0x06 , 0x3d , 0x35 , 0x2d , 0x25 , 0x1d , 0x15 , 0x0d , 0x05 , 0x1c , 0x14 , 0x0c , 0x04
Cons_pc2					DCB 0x0e , 0x11 , 0x0b , 0x18 , 0x01 , 0x05 , 0x03 , 0x1c , 0x0f , 0x06 , 0x15 , 0x0a , 0x17 , 0x13 , 0x0c , 0x04 , 0x1a , 0x08 , 0x10 , 0x07 , 0x1b , 0x14 , 0x0d , 0x02 , 0x29 , 0x34 , 0x1f , 0x25 , 0x2f , 0x37 , 0x1e , 0x28 , 0x33 , 0x2d , 0x21 , 0x30 , 0x2c , 0x31 , 0x27 , 0x38 , 0x22 , 0x35 , 0x2e , 0x2a , 0x32 , 0x24 , 0x1d , 0x20
Cons_Iter_shift				DCB 0x01 , 0x01 , 0x02 , 0x02 , 0x02 , 0x02 , 0x02 , 0x02 , 0x01 , 0x02 , 0x02 , 0x02 , 0x02 , 0x02 , 0x02 , 0x01
SBOX						DCB 0x0e , 0x04 , 0x0d , 0x01 , 0x02 , 0x0f , 0x0b , 0x08 , 0x03 , 0x0a , 0x06 , 0x0c , 0x05 , 0x09 , 0x00 , 0x07 , 0x00 , 0x0f , 0x07 , 0x04 , 0x0e , 0x02 , 0x0d , 0x01 , 0x0a , 0x06 , 0x0c , 0x0b , 0x09 , 0x05 , 0x03 , 0x08 , 0x04 , 0x01 , 0x0e , 0x08 , 0x0d , 0x06 , 0x02 , 0x0b , 0x0f , 0x0c , 0x09 , 0x07 , 0x03 , 0x0a , 0x05 , 0x00 , 0x0f , 0x0c , 0x08 , 0x02 , 0x04 , 0x09 , 0x01 , 0x07 , 0x05 , 0x0b , 0x03 , 0x0e , 0x0a , 0x00 , 0x06 , 0x0d ,0x0f , 0x01 , 0x08 , 0x0e , 0x06 , 0x0b , 0x03 , 0x04 , 0x09 , 0x07 , 0x02 , 0x0d , 0x0c , 0x00 , 0x05 , 0x0a , 0x03 , 0x0d , 0x04 , 0x07 , 0x0f , 0x02 , 0x08 , 0x0e , 0x0c , 0x00 , 0x01 , 0x0a , 0x06 , 0x09 , 0x0b , 0x05 , 0x00 , 0x0e , 0x07 , 0x0b , 0x0a , 0x04 , 0x0d , 0x01 , 0x05 , 0x08 , 0x0c , 0x06 , 0x09 , 0x03 , 0x02 , 0x0f , 0x0d , 0x08 , 0x0a , 0x01 , 0x03 , 0x0f , 0x04 , 0x02 , 0x0b , 0x06 , 0x07 , 0x0c , 0x00 , 0x05 , 0x0e , 0x09 ,0x0a , 0x00 , 0x09 , 0x0e , 0x06 , 0x03 , 0x0f , 0x05 , 0x01 , 0x0d , 0x0c , 0x07 , 0x0b , 0x04 , 0x02 , 0x08 , 0x0d , 0x07 , 0x00 , 0x09 , 0x03 , 0x04 , 0x06 , 0x0a , 0x02 , 0x08 , 0x05 , 0x0e , 0x0c , 0x0b , 0x0f , 0x01 , 0x0d , 0x06 , 0x04 , 0x09 , 0x08 , 0x0f , 0x03 , 0x00 , 0x0b , 0x01 , 0x02 , 0x0c , 0x05 , 0x0a , 0x0e , 0x07 , 0x01 , 0x0a , 0x0d , 0x00 , 0x06 , 0x09 , 0x08 , 0x07 , 0x04 , 0x0f , 0x0e , 0x03 , 0x0b , 0x05 , 0x02 , 0x0c ,0x07 , 0x0d , 0x0e , 0x03 , 0x00 , 0x06 , 0x09 , 0x0a , 0x01 , 0x02 , 0x08 , 0x05 , 0x0b , 0x0c , 0x04 , 0x0f , 0x0d , 0x08 , 0x0b , 0x05 , 0x06 , 0x0f , 0x00 , 0x03 , 0x04 , 0x07 , 0x02 , 0x0c , 0x01 , 0x0a , 0x0e , 0x09 , 0x0a , 0x06 , 0x09 , 0x00 , 0x0c , 0x0b , 0x07 , 0x0d , 0x0f , 0x01 , 0x03 , 0x0e , 0x05 , 0x02 , 0x08 , 0x04 , 0x03 , 0x0f , 0x00 , 0x06 , 0x0a , 0x01 , 0x0d , 0x08 , 0x09 , 0x04 , 0x05 , 0x0b , 0x0c , 0x07 , 0x02 , 0x0e ,0x02 , 0x0c , 0x04 , 0x01 , 0x07 , 0x0a , 0x0b , 0x06 , 0x08 , 0x05 , 0x03 , 0x0f , 0x0d , 0x00 , 0x0e , 0x09 , 0x0e , 0x0b , 0x02 , 0x0c , 0x04 , 0x07 , 0x0d , 0x01 , 0x05 , 0x00 , 0x0f , 0x0a , 0x03 , 0x09 , 0x08 , 0x06 , 0x04 , 0x02 , 0x01 , 0x0b , 0x0a , 0x0d , 0x07 , 0x08 , 0x0f , 0x09 , 0x0c , 0x05 , 0x06 , 0x03 , 0x00 , 0x0e , 0x0b , 0x08 , 0x0c , 0x07 , 0x01 , 0x0e , 0x02 , 0x0d , 0x06 , 0x0f , 0x00 , 0x09 , 0x0a , 0x04 , 0x05 , 0x03 ,0x0c , 0x01 , 0x0a , 0x0f , 0x09 , 0x02 , 0x06 , 0x08 , 0x00 , 0x0d , 0x03 , 0x04 , 0x0e , 0x07 , 0x05 , 0x0b , 0x0a , 0x0f , 0x04 , 0x02 , 0x07 , 0x0c , 0x09 , 0x05 , 0x06 , 0x01 , 0x0d , 0x0e , 0x00 , 0x0b , 0x03 , 0x08 , 0x09 , 0x0e , 0x0f , 0x05 , 0x02 , 0x08 , 0x0c , 0x03 , 0x07 , 0x00 , 0x04 , 0x0a , 0x01 , 0x0d , 0x0b , 0x06 , 0x04 , 0x03 , 0x02 , 0x0c , 0x09 , 0x05 , 0x0f , 0x0a , 0x0b , 0x0e , 0x01 , 0x07 , 0x06 , 0x00 , 0x08 , 0x0d,0x04 , 0x0b , 0x02 , 0x0e , 0x0f , 0x00 , 0x08 , 0x0d , 0x03 , 0x0c , 0x09 , 0x07 , 0x05 , 0x0a , 0x06 , 0x01 , 0x0d , 0x00 , 0x0b , 0x07 , 0x04 , 0x09 , 0x01 , 0x0a , 0x0e , 0x03 , 0x05 , 0x0c , 0x02 , 0x0f , 0x08 , 0x06 , 0x01 , 0x04 , 0x0b , 0x0d , 0x0c , 0x03 , 0x07 , 0x0e , 0x0a , 0x0f , 0x06 , 0x08 , 0x00 , 0x05 , 0x09 , 0x02 , 0x06 , 0x0b , 0x0d , 0x08 , 0x01 , 0x04 , 0x0a , 0x07 , 0x09 , 0x05 , 0x00 , 0x0f , 0x0e , 0x02 , 0x03 , 0x0c ,0x0d , 0x02 , 0x08 , 0x04 , 0x06 , 0x0f , 0x0b , 0x01 , 0x0a , 0x09 , 0x03 , 0x0e , 0x05 , 0x00 , 0x0c , 0x07 , 0x01 , 0x0f , 0x0d , 0x08 , 0x0a , 0x03 , 0x07 , 0x04 , 0x0c , 0x05 , 0x06 , 0x0b , 0x00 , 0x0e , 0x09 , 0x02 , 0x07 , 0x0b , 0x04 , 0x01 , 0x09 , 0x0c , 0x0e , 0x02 , 0x00 , 0x06 , 0x0a , 0x0d , 0x0f , 0x03 , 0x05 , 0x08 , 0x02 , 0x01 , 0x0e , 0x07 , 0x04 , 0x0a , 0x08 , 0x0d , 0x0f , 0x0c , 0x09 , 0x00 , 0x03 , 0x05 , 0x06 , 0x0b
Cons_ER DCB 0x0F, 0xFF, 0xFF, 0xF0

MODEENC		DCB 0X00 ; 00 MEANS ENCRYPT, REST DECRYPT
;KEY  		DCB 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f
;CIPHER_TEXT DCB 0x00, 0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77,0x88, 0x99, 0xaa, 0xbb, 0xcc, 0xdd, 0xee, 0xff

KEY  		DCB 0x94,0x74,0xB8,0xE8,0x57,0x5B,0x5A,0x7D
CIPHER_TEXT DCB 0x94,0x74,0xB8,0xE8,0xC7,0x3B,0xCA,0x7D

;---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
;---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
__F0CLRLOOPPPP FUNCTION	
		PUSH {LR}
		
		PUSH {R0-R3}

		MOV R3,#0
		
		LDR R0,=DES_C
		MOV R2,#0
CCL1	STRB R3,[R0,R2]
		ADD R2,R2,#1
		CMP R2,#4
		BNE CCL1
		
		LDR R0,=DES_D
		MOV R2,#0
CCL2	STRB R3,[R0,R2]
		ADD R2,R2,#1
		CMP R2,#4
		BNE CCL2

		LDR R0,=DES_L
		MOV R2,#0
CCL3	STRB R3,[R0,R2]
		ADD R2,R2,#1
		CMP R2,#4
		BNE CCL3
		
		LDR R0,=DES_R
		MOV R2,#0
CCL4	STRB R3,[R0,R2]
		ADD R2,R2,#1
		CMP R2,#4
		BNE CCL4
		
		LDR R0,=DES_s_output
		MOV R2,#0
CCL5	STRB R3,[R0,R2]
		ADD R2,R2,#1
		CMP R2,#4
		BNE CCL5
		
		LDR R0,=DES_f_function_res
		MOV R2,#0
CCL6	STRB R3,[R0,R2]
		ADD R2,R2,#1
		CMP R2,#4
		BNE CCL6
		
		LDR R0,=DES_temp
		MOV R2,#0
CCL7	STRB R3,[R0,R2]
		ADD R2,R2,#1
		CMP R2,#4
		BNE CCL7
		
		LDR R0,=DES_sub_key
		MOV R2,#0
CCL8	STRB R3,[R0,R2]
		ADD R2,R2,#1
		CMP R2,#128
		BNE CCL8
		
		LDR R0,=DES_s_input
		MOV R2,#0
CCL9	STRB R3,[R0,R2]
		ADD R2,R2,#1
		CMP R2,#8
		BNE CCL9
		
		LDR R0,=DES_permuted_choice_1
		MOV R2,#0
CCL10	STRB R3,[R0,R2]
		ADD R2,R2,#1
		CMP R2,#8
		BNE CCL10
		
		LDR R0,=DES_permuted_choice_2
		MOV R2,#0
CCL11	STRB R3,[R0,R2]
		ADD R2,R2,#1
		CMP R2,#8
		BNE CCL11
		
		LDR R0,=DES_init_perm_res
		MOV R2,#0
CCL12	STRB R3,[R0,R2]
		ADD R2,R2,#1
		CMP R2,#8
		BNE CCL12
		
		LDR R0,=DES_inv_init_perm_res
		MOV R2,#0
CCL13	STRB R3,[R0,R2]
		ADD R2,R2,#1
		CMP R2,#8
		BNE CCL13
		
		LDR R0,=DES_pre_output
		MOV R2,#0
CCL14	STRB R3,[R0,R2]
		ADD R2,R2,#1
		CMP R2,#8
		BNE CCL14
		

		POP {R0-R3}
		POP {LR}
		BX LR
		ENDFUNC
;---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
;---------------------------------------------------------------------------------------------------------------------------------------------------------------------------

__F1INITPERMRES FUNCTION	
		PUSH {LR}
		PUSH {R0-R8}
		
		LDR R0,=CIPHER_TEXT
		LDR R4,=Init_Permutation
		
		LDR R1,[R0]
		LDR R2,[R0,#4]
		
		;INIT_PERM_RES R6 HIGHER R7 LOWER
		MOV R6,#0
		MOV R7,#0
		MOV R8,#64

		MOV R3,#0

INLPBK  LDRB R5,[R4,R0]
		SUB R5,R8,R5
		CMP R5,#32
		BGE INLPBK1
		LSR R5,R2,R5
		B INLPBK2
INLPBK1	SUB R5,R5,#32
		LSR R5,R1,R5
INLPBK2 AND R5,R5,#1
		CMP R3,#32
		BGE INLPBK3
		LSL R6,R6,#1
		ORR R6,R6,R5
		B INLPBK4
INLPBK3 LSL R7,R7,#1
		ORR R7,R7,R5
INLPBK4	ADD R3,R3,#1
		CMP R3,#64
		BNE INLPBK

		LDR R4,=DES_init_perm_res
		STR R6,[R4]
		STR R7,[R4,#4]

		LDR R4,=DES_L
		STR R6,[R4]

		LDR R4,=DES_R
		STR R7,[R4]
		;---------------------------------
		LDR R0,=KEY
		LDR R4,=Cons_pc1
		
		LDR R1,[R0]
		LDR R2,[R0,#4]
		
		;INIT_PERM_RES R6 HIGHER R7 LOWER
		MOV R6,#0
		MOV R7,#0
		mov R8,#64

		MOV R3,#0

INLPBE  LDRB R5,[R4,R0]
		SUB R5,R8,R5
		CMP R5,#32
		BGE INLPBE1
		LSR R5,R2,R5
		B INLPBE2
INLPBE1	SUB R5,R5,#32
		LSR R5,R1,R5
INLPBE2 AND R5,R5,#1
		CMP R3,#32
		BGE INLPBE3
		LSL R6,R6,#1
		ORR R6,R6,R5
		B INLPBE4
INLPBE3 LSL R7,R7,#1
		ORR R7,R7,R5
INLPBE4	ADD R3,R3,#1
		CMP R3,#64
		BNE INLPBE

		LDR R4,=DES_permuted_choice_1
		STR R6,[R4]
		STR R7,[R4,#4]
		
		AND R0,R7,#0x0FFFFFFF
		LDR R4,=DES_D
		STR R0,[R4]

		LSR R7,R7,#28
		LSL R6,R6,#4
		LDR R12, Cons_ER
		LDR R12, [R12]
		;MOV R12,#0x0FFFFFF0
		AND R6,R6,R12
		ORR R6,R6,R7
		LDR R4,=DES_C
		STR R6,[R4]

		
		POP {R0-R8}
		POP {LR}
		BX LR
		ENDFUNC
;---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
;---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
__F2PERKEY	FUNCTION	
		PUSH {LR}
		LDR R1,=DES_C
		LDR R1,[R1]
		
		LDR R2,=DES_D
		LDR R2,[R2]
		
		MOV R3,#0

ITLPI	LDR R4,=Cons_Iter_shift
		LDRB R4,[R4,R3]
ITLPI1	LSL R0,R1,#1
		AND R0,R0,#0x0FFFFFFF
		LSR R1,R1,#27
		AND R1,R1,#0x00000001
		ORR R1,R0,R1

		LSL R0,R2,#1
		AND R0,R0,#0x0FFFFFFF
		LSR R2,R2,#27
		AND R2,R2,#0x00000001
		ORR R2,R0,R2

		SUB R4,R4,#1
		CMP R4, #0
		BNE ITLPI1

		MOV R0,#0
		MOV R4,#0

		LSR R0,R1,#4

		LSL R5,R1,#28
		ORR R4,R5,R2
		LDR R5,=DES_permuted_choice_2
		STR R0,[R5]
		STR R4,[R5,#4]
		MOV R9,R3
		
		
		;---------------------------------
		PUSH {R0-R8}
		LDR R0,=DES_permuted_choice_2
		LDR R4,=Cons_pc2
		
		LDR R1,[R0]
		LDR R2,[R0,#4]
		
		;INIT_PERM_RES R6 HIGHER R7 LOWER
		MOV R6,#0
		MOV R7,#0
		mov R8,#56

		MOV R3,#0

INBE  	LDRB R5,[R4,R0]
		SUB R5,R8,R5
		CMP R5,#32
		BGE INBE1
		LSR R5,R2,R5
		B INBE2
INBE1	SUB R5,R5,#32
		LSR R5,R1,R5
INBE2 	AND R5,R5,#1
		CMP R3,#32
		BGE INBE3
		LSL R6,R6,#1
		ORR R6,R6,R5
		B INBE4
INBE3 	LSL R7,R7,#1
		ORR R7,R7,R5
INBE4	ADD R3,R3,#1
		CMP R3,#48
		BNE INBE

		LDR R4,=DES_sub_key
		MOV R3,#8
		MUL R9,R9,R3
		ADD R4,R4,R3
		STR R6,[R4]
		STR R7,[R4,#4]

		POP {R0-R8}
		;-------------------------
		LDR R0,=DES_C
		STR R1,[R0]
		LDR R0,=DES_D
		STR R2,[R0]

		ADD R3,R3,#1
		CMP R3,#16
		BNE ITLPI


		POP {LR}
		BX LR
		LTORG
		ENDFUNC
;---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
;---------------------------------------------------------------------------------------------------------------------------------------------------------------------------

__F3ROUND FUNCTION	
		PUSH {LR}
		
		MOV R0,#0
		LDR R11,=DES_R
		LDR R11,[R11]


RONDL	MOV R1,#0	;S_INPUTUPPER
		MOV R2,#0	;S_INPUTLOWER

		MOV R3,#0
RONDL1	LDR R4,=Cons_E
		LDRB R4,[R4,R3]
		MOV R5,#32
		SUB R4,R5,R4
		LSR R5,R11,R4
		AND R5,R5,#0x00000001
		CMP R3,#12
		BGE RONDL2
		LSL R1,R1,#1
		ORR R1,R1,R5
		B RONDL3
RONDL2	LSL R2,R2,#1
		ORR R2,R2,R5
RONDL3	ADD R3,R3,#1
		CMP R3,#48
		BNE RONDL1

		;//ENCRYPT/DECRYPT
		LDR R3,=MODEENC
		LDRB R3,[R3]
		CMP R3,#0
		BNE ENCR
		MOV R5,#8
		MOV R6,#16
		SUB R6,R6,R0
		MUL R5,R6,R5		 
		B RONDL4
ENCR	MOV R5,#8
		MUL R5,R6,R5		 
RONDL4	LDR R6,=DES_sub_key
		LDR R3,[R6,R5]
		ADD R5,R5,#4
		LDR R4,[R6,R5]
		EOR R1,R1,R3
		EOR R2,R2,R4

		;//----------------------
		
		MOV R3,#0

ONDL1	MOV R4,#6
		MUL R4,R4,R3
		MOV R5,#0x00008400
		MOV R6,#0x00000000
		LSR R6,R6,R4
		CMP R4,#32
		BGE ONDL2
		MOV R7,#32
		SUB R7,R7,R4
		LSL R7,R5,R7
		ORR R6,R6,R7
		LSR R5,R5,R4
		B ONDL3
ONDL2	MOV R7,#32
		SUB R7,R4,R7
		LSR R6,R5,R7
		MOV R6,#0
ONDL3	AND R5,R1,R5
		AND R6,R2,R6
		
		MOV R11,#42
		SUB R4,R11,R4
		LSR R6,R6,R4
		CMP R4,#32
		BGE ONDL4
		MOV R7,#32
		SUB R7,R7,R4
		LSL R7,R5,R7
		ORR R6,R6,R7
		LSR R5,R5,R4
		B ONDL5
ONDL4	MOV R7,#32
		SUB R7,R4,R7
		LSR R6,R5,R7
		MOV R6,#0
ONDL5	AND R6,R6,#0x0000000F

		LSR R4,R6,#4
		AND R5,R6,#0x00000001
		ORR R6,R4,R5
		LDR R4,=DES_SATIR
		STRB R6,[R4]
;------------------SATUN

PNDL1	MOV R4,#6
		MUL R4,R4,R3
		MOV R5,#0x00007800
		MOV R6,#0x00000000
		LSR R6,R6,R4
		CMP R4,#32
		BGE PNDL2
		MOV R7,#32
		SUB R7,R7,R4
		LSL R7,R5,R7
		ORR R6,R6,R7
		LSR R5,R5,R4
		B PNDL3
PNDL2	MOV R7,#32
		SUB R7,R4,R7
		LSR R6,R5,R7
		MOV R6,#0
PNDL3	AND R5,R1,R5
		AND R6,R2,R6
		
		MOV R11,#43
		SUB R4,R11,R4
		LSR R6,R6,R4
		CMP R4,#32
		BGE PNDL4
		MOV R7,#32
		SUB R7,R7,R4
		LSL R7,R5,R7
		ORR R6,R6,R7
		LSR R5,R5,R4
		B PNDL5
PNDL4	MOV R7,#32
		SUB R7,R4,R7
		LSR R6,R5,R7
		MOV R6,#0
PNDL5	AND R6,R6,#0x0000000F

		LDR R4,=DES_SATUN
		STRB R6,[R4]
;-----------------
		LDR R4,=DES_s_output
		LDR R5,[R4]
		LSR R5,R5,#4
		LDR R4,=DES_SATIR
		LDR R6,[R4]
		LDR R4,=DES_SATUN
		LDR R7,[R4]
		MOV R4,#16
		MUL R6,R4,R6
		ADD R6,R6,R7
		MOV R4,#64
		MUL R4,R4,R3
		ADD R6,R4,R6
		LDR R4,=SBOX
		LDRB R4,[R4,R6]
		AND R4,R4,#0x0000000F
		ORR R5,R5,R4
		LDR R4,=DES_s_output
		STR R5,[R4]

		ADD R3,R3,#1
		CMP R3,#8
		BNE ONDL1
;------------------
		MOV R3,#0
		MOV R4,#0 ;F_FUNCTION_RES
		LDR R11,=Cons_P
FRESL	LSL R4,R4,#1
		LDR R6,[R11,R3]
		MOV R7,#32
		SUB R6,R7,R6
		LSR R6,R5,R6
		AND R6,R6,#0x00000001
		ORR R4,R4,R6

		ADD R3,R3,#1
		CMP R3,#32
		BNE FRESL

;-----------------
		LDR R3,=DES_R
		LDR R5,[R3]
		LDR R3,=DES_L
		LDR R6,[R3]

		EOR R7,R6,R4
		LDR R3,=DES_R
		STR R7,[R3]
		
		LDR R3,=DES_L
		STR R5,[R3]
;------------------



		ADD R0,R0,#1
		CMP R0,#16
		BNE RONDL

		POP {LR}
		BX LR
		LTORG
		ENDFUNC
;---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
;---------------------------------------------------------------------------------------------------------------------------------------------------------------------------

;---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
__F4INVPERMUTATION	FUNCTION	
		PUSH {LR}
		
		LDR R4,=Init_Permutation
		
		;DIRECTLY LOADING PRE_OUTPUT

		LDR R0,=DES_R
		LDR R1,[R0]
		LDR R0,=DES_L
		LDR R2,[R0]
		
		;INV_INIT_PERM_RES R6 HIGHER R7 LOWER
		MOV R6,#0
		MOV R7,#0
		MOV R8,#64

		MOV R3,#0

INLK  LDRB R5,[R4,R0]
		SUB R5,R8,R5
		CMP R5,#32
		BGE INLK1
		LSR R5,R2,R5
		B INLK2
INLK1	SUB R5,R5,#32
		LSR R5,R1,R5
INLK2 	AND R5,R5,#1
		CMP R3,#32
		BGE INLK3
		LSL R6,R6,#1
		ORR R6,R6,R5
		B INLK4
INLK3 	LSL R7,R7,#1
		ORR R7,R7,R5
INLK4	ADD R3,R3,#1
		CMP R3,#64
		BNE INLK

		LDR R4,=DES_inv_init_perm_res
		STR R6,[R4]
		STR R7,[R4,#4]

		POP {LR}

		BX LR
		LTORG
		ENDFUNC


;---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
__DESENCRYPT FUNCTION	
		PUSH {LR}
		
		BL __F0CLRLOOPPPP
		BL __F1INITPERMRES ; permutations
		BL __F2PERKEY ; key transformation
		BL __F3ROUND ;roudning function 
		BL __F4INVPERMUTATION ; inverse permutations
		POP {LR}


		BX LR
		ENDFUNC
;---------------------------------------------------------------------------------------------------------------------------------------------------------------------------

;---------------------------------------------------------------------------------------------------------------------------------------------------------------------------

__main  FUNCTION
	
		BL __DESENCRYPT
stop    B stop ; stop program
     ENDFUNC
     END 
		 
		